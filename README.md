# ENS<sup>2</sup> ![GitHub](https://img.shields.io/github/license/tinlab/ens2) ![GitHub release (latest by date)](https://img.shields.io/github/v/release/tinlab/ens2?color=success) ![](https://visitor-badge.glitch.me/badge?page_id=tinlab.ens2) ![GitHub release (latest by date including pre-releases)](https://img.shields.io/github/downloads-pre/tinlab/ens2/latest/total)

**ENS<sup>2</sup>:** **E**ffective and **E**fficient **N**eural **N**etworks for **S**pike Inference from Calcium **S**ignal

The ENS<sup>2</sup> is a data-driven system for inferring both continuous spike-rate and discrete spike-event from original Î”F/F calcium traces.

![Workflow](/saved_image/Workflow.png)
<br></br>

## What's here:
This repo provides the software package described in this paper: [Effective and Efficient Neural Networks for Spike Inference from In Vivo Calcium Imaging](https://www.biorxiv.org/content/10.1101/2021.08.30.458217v3).

It includes:
- Pre-trained ENS<sup>2</sup> models for spike inference from calcium signal
- A demo showing how to use the ENS<sup>2</sup> system on sample data
- A demo reproducing the benchmark results in [our paper](https://www.biorxiv.org/content/10.1101/2021.08.30.458217v3)
- A tool to visualize the inference results from ENS<sup>2</sup>  

Please refer to the following instructions on usage, or [Readme.doc](/Readme.doc) for offline views. 
<br></br>

## Getting started:
### Use ENS<sup>2</sup> to infer on sample data or your own data:

- **Hardware requirement**: a typical PC. 

> The ENS<sup>2</sup> works with both **CPU** and **GPU**. We've provided the pre-trained ENS<sup>2</sup> models so that re-training from scratch is not needed.  
> However, we recommend deploying ENS<sup>2</sup> on a PC with GPU support for speeding up when inferencing on large scales of recordings, or when you want to re-train the model of your choice (see below). 

- **Software requirement**: typical Python based libraries.

> **Python** & **jupyter notebook**  
> **PyTorch**: for deploying neural networks  
> **NumPy** & **SciPy**: for scientific computing  
> (optional) CUDA and cuDNN toolkits if you're working on a GPU

- **How to**: follow the demo as in [ENS2_demo.ipynb](/ENS2_demo.ipynb)

### Run the benchmark as in [our paper](https://www.biorxiv.org/content/10.1101/2021.08.30.458217v3):

- **Hardware requirement**: a PC with GPU support.  

> The benchmark [database](/ground_truth/) contains over 20 hours of recordings from excitatory neurons, and over 15 hours of recordings from inhibitory neurons. Deploying large scales of simulations on CPU would be extremely time-consuming. 

- **Software requirement**: typical Python based libraries + MATLAB.  

> **Python** & **jupyter notebook**  
> **PyTorch**: for deploying neural networks  
> **NumPy** & **SciPy**: for scientific computing  
> (required) **CUDA** and **cuDNN** toolkits for GPU support  
> (required) **MATLAB engine** for Python: for evaluating spike-event predictions in benchmark

- **How to**: follow the demo as in [Benchmark_demo.ipynb](/Benchmark_demo.ipynb)

### Visualize the inferenced results from ENS<sup>2</sup>:

- Please see the MATLAB code [visualizer.m](/visualizer.m) for reference. 

<br></br>

## Example inference results from ENS<sup>2</sup>:
![Workflow](/saved_image/Examples.png)
<br></br>

## File structure:
| Folder / File | Description   |
| ------------- | ------------- |
| /ground_truth/...| Folder to store database for benchmark or training models <sup>[Note]</sup> |
| /results/...     | Contains inference results from ENS<sup>2</sup>  |
| /sample_data/... | Contains sample data to reproduce results in [paper](https://www.biorxiv.org/content/10.1101/2021.08.30.458217v3)  |
| /saved_image/... | Contains sample images generated by ENS<sup>2</sup> as in [paper](https://www.biorxiv.org/content/10.1101/2021.08.30.458217v3)  |
| /saved_model/... | Contains pre-trained ENS<sup>2</sup> model  |
| /Benchmark_demo.ipynb | Notebook with examples to reproduce benchmark  |
| /ENS2.py              | Core modules of ENS<sup>2</sup>  |
| /ENS2_demo.ipynb      | Notebook with example usage of ENS<sup>2</sup>  |
| /Models.py            | Network models used in benchmark  |
| /computeER.m          | Helper function to compute error rate  |
| /spkd.m               | Helper function to compute Victor-Purpura distance  |
| /pytorchtools.py      | Helper function for early-stopping in training  |
| /visualizer.m         | MATLAB script for visualizing results from ENS<sup>2</sup>  |
  
  
#
**[Note]**: The ground truth database for running benchmark and training models is described in [another paper](https://www.nature.com/articles/s41593-021-00895-5), and is obtainable from [the CASCADE repo](https://github.com/HelmchenLabSoftware/Cascade).

#
(This repo is currently under maintenance)
